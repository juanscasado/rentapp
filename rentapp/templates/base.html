{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  {% block title %}<title>RentAventa</title>{% endblock %}
  <!-- Iconos de Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
  <!-- Bootstrap -->
  <!-- <link href="/media/bootstrap-5.3.1-dist/css/bootstrap.min.css" rel="stylesheet"> -->
  <link href="{% static '/rentapp/bootstrap-5.3.1-dist/css/bootstrap.min.css' %}" rel="stylesheet">
  <script src="{% static '/rentapp/bootstrap-5.3.1-dist/js/bootstrap.bundle.min.js' %}"></script>
  <!-- <script src="/media/bootstrap-5.3.1-dist/js/bootstrap.bundle.min.js"></script> -->
  <!-- <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script> -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

  <style>
    body {
      text-align: center;
    }
    .pagination {
      justify-content: center;
    }
    .card {
      min-height: 325px;
    }
  </style>
  <!-- Add additional CSS in static file -->
  <!-- {% load static %} -->
  <!-- <link rel="stylesheet" href="{% static 'css/styles.css' %}">-->
</head>

<body>
  <div class="container-fluid">
    <div class="row col-12 align-items-stretch  g-2">
      <!--Header-->
      {% block header %}
<header class="col-12">
  <a target="_parent" href="{% url 'rentapp:index' %}">
    <h1 class="display-1">RentAventa</h1>
  </a>
  <p class="lead">Renta, compra y venta.</p>

  <nav class="navbar bg-transparent">
    <div class="container-fluid d-flex flex-wrap gap-2">
      {% if request.user.is_authenticated %}
        <a class="btn btn-primary mb-3" href="{% url 'rentapp:insertar_local' %}">Local</a>
        <a class="btn btn-secondary mb-3" href="{% url 'rentapp:buscar' %}">Buscar</a>
        <a class="btn btn-outline-primary mb-3" href="{% url 'rentapp:dashboard' request.user.id %}">Dashboard</a>
        <a class="btn btn-outline-info mb-3 position-relative" href="{% url 'rentapp:conversaciones' %}" id="btn-mensajes">
          <i class="bi bi-chat-dots"></i> Mensajes
          <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="contador-mensajes" style="display:none;">
            0
          </span>
        </a>

        <form method="post" action="{% url 'logout' %}" class="d-inline ms-auto mb-3">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger">Salir</button>
        </form>
      {% else %}
        <a class="btn btn-secondary mb-3" href="{% url 'rentapp:buscar' %}">Buscar</a>
        <a class="btn btn-primary mb-3" href="{% url 'auth_login' %}">Entrar</a>
        <a class="btn btn-outline-primary mb-3" href="{% url 'registration_register' %}">Registrarse</a>
      {% endif %}
    </div>
  </nav>
</header>
      {% endblock %}

        <!--Saludos-->
        {% if not user.is_authenticated %}

        {% block saludos %}
        <div class="col-12">
          <div class="alert alert-primary fade show" role="alert">
            <!-- <strong>Te saluda [RENTAPP]!</strong> You should check in on some of those fields below. -->
            <div class="row row-cols-12 row-cols-sm-12 ">
              <div id="testimonios-carrusel" class="carousel carousel-dark slide " data-bs-ride="carousel">
                  <div class="carousel-inner">
                      <div class="carousel-item active">
                          <div class="container">
                              <b><u>Fácil y Seguro</u></b>
                              <div class="testimonio-info">
                                  <p>Usar nuestro sitio web para rentar es fácil y seguro.</p>
                              </div>
                          </div>
                      </div>
                      <div class="carousel-item">
                          <div class="container">
                              <b><u>Compra con Confianza</u></b>
                              <div class="testimonio-info">
                                  <p>Comprar una propiedad nunca ha sido tan sencillo.</p>
                              </div>
                          </div>
                      </div>
                      <div class="carousel-item">
                          <div class="container">
                              <b><u>Vende Rápido y Fácil</u></b>
                              <div class="testimonio-info">
                                  <p>Vender tu propiedad es rápido y fácil con nuestro sitio web.</p>
                              </div>
                          </div>
                      </div>
                  </div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#testimonios-carrusel" 
                    data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Anterior</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#testimonios-carrusel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Siguiente</span>
                  </button>
              </div>
          </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          <!-- <div class="alert alert-warning alert-dismissible fade show row col-12 align-items-stretch g-2" role="alert">
            <p>[RENTAPP] renta, compra y venta.</p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div> -->
        </div>
        {% endblock %}
        {% endif %}
        <!--block content-->
        <div class="col-sm-12">
          {% block content %}
          <!-- block for the content -->
          {% endblock %}
        </div>
        <!--block content-->
        <div class="col-sm-12">
          {% block pagination %}
          <!-- block for the pagination -->
          {% endblock %}
        </div>

      {% block footer %}
    <!--block footer-->
    <div class="col-sm-12">
      <footer>
        <p>Author: Winfreak<br>
        <a href="mailto:juans.casado@gmail.com">juans.casado@gmail.com</a></p>
      </footer>      
    </div>
      {% endblock %}
    </div>
  </div>
</body>

</html>

{% if request.user.is_authenticated %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Notificaciones globales de mensajes no leídos
$(document).ready(function(){
  function actualizarContadorMensajes() {
    $.ajax({
      url: "{% url 'rentapp:contar_mensajes_no_leidos' %}",
      type: 'GET',
      success: function(resp){
        const total = resp.total_no_leidos || 0;
        const $contador = $('#contador-mensajes');
        
        if (total > 0) {
          $contador.text(total > 99 ? '99+' : total).fadeIn();
          
          // Actualizar título de la página
          if (document.title.indexOf('(') === -1) {
            document.title = `(${total}) ${document.title}`;
          } else {
            document.title = document.title.replace(/\(\d+\)/, `(${total})`);
          }
        } else {
          $contador.fadeOut();
          // Limpiar título
          document.title = document.title.replace(/\(\d+\)\s/, '');
        }
      },
      error: function(){
        console.warn('Error al obtener contador de mensajes');
      }
    });
  }

  // Actualizar cada 5 segundos
  actualizarContadorMensajes();
  setInterval(actualizarContadorMensajes, 5000);
});
</script>
{% endif %}